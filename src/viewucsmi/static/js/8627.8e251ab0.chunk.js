"use strict";(self.webpackChunkupward=self.webpackChunkupward||[]).push([[8627],{9109:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var r=n(74165),a=n(15861),u=n(29439),c=n(72791),o=n(91933),l=n(3380),i=n(637),s=n(15703),d=n(48910),p=n(36151),f=n(81258),h=n(21830),x=n.n(h),m=n(65413),C=n(70272),y=(n(44061),n(5403)),k=n(64230),N=n(80184),v=[{key:"Check_Date",label:"Date",width:80},{key:"Bank",label:"Bank",width:150},{key:"Check_No",label:"Check No",width:150},{key:"Check_Amnt",label:"Amount",width:120},{key:"Status",label:"Status",width:150},{key:"RCPNO",label:"RCPNO",width:150}];function w(){var e,t,n,h,w,R,g,b=(0,c.useContext)(l.V),S=b.myAxios,P=b.user,D=(0,i.Z)().executeQueryToClient,j=(0,c.useState)(""),Z=(0,u.Z)(j,2),E=Z[0],O=Z[1],_=(0,c.useRef)(D),A=(0,c.useRef)(null),T=(0,c.useRef)(null),F=(0,c.useRef)(null),I=(0,c.useRef)(null),q=(0,c.useRef)(null),B=(0,c.useRef)(null),M=(0,c.useRef)(null),z=(0,c.useRef)(null),L=(0,c.useRef)(null),H=(0,o.useMutation)({mutationKey:"save-pullout-request",mutationFn:function(t){return(e=e||(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.post("/task/accounting/pullout/reqeust/save-pullout-request",t,{headers:{Authorization:"Bearer ".concat(null===P||void 0===P?void 0:P.accessToken)}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},onSuccess:function(e,t){var n=e;return n.data.success?(re(),x().fire({position:"center",icon:"success",title:n.data.message,timer:1500})):x().fire({position:"center",icon:"warning",title:n.data.message,timer:1500})}}),K=H.isLoading,W=H.mutate,V=(0,o.useMutation)({mutationKey:"get-selected-rcpn-no",mutationFn:function(e){return(t=t||(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.post("/task/accounting/pullout/reqeust/get-selected-rcpn-no",t,{headers:{Authorization:"Bearer ".concat(null===P||void 0===P?void 0:P.accessToken)}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},onSuccess:function(e){var t=e.data.data[0];T.current&&(T.current.value=t.RCPNo),F.current&&(F.current.value=t.PNNo),I.current&&(I.current.value=t.Name),q.current&&(q.current.value=t.Reason),ae(t.PNNo)}}),U=V.isLoading,Y=V.mutate,G=(0,d._j)({link:"/task/accounting/pullout/reqeust/get-pnno-client",column:[{key:"PNo",label:"PN No.",width:150},{key:"Name",label:"Client Name",width:270}],getSelectedItem:function(e,t,u,c){return(n=n||(0,a.Z)((0,r.Z)().mark((function e(t,n,a,u){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(F.current&&(F.current.value=t[0]),I.current&&(I.current.value=t[1]),ae(t[0]),X());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}),J=G.UpwardTableModalSearch,Q=G.openModal,X=G.closeModal,$=(0,d._j)({link:"/task/accounting/pullout/reqeust/get-rcpn-no",column:[{key:"RCPNo",label:"RCPN No.",width:400}],getSelectedItem:function(e,t,n,u){return(h=h||(0,a.Z)((0,r.Z)().mark((function e(t,n,a,u){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(Y({rcpno:t[0]}),ne());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}),ee=$.UpwardTableModalSearch,te=$.openModal,ne=$.closeModal,re=function(){return(w=w||(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'",e.next=3,_.current("\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'");case 3:t=e.sent,n=t.data,T.current&&(T.current.value="HOPO".concat(n.data[0].Year).concat(n.data[0].Count));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},ae=function(e){return(R=R||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,c,o,l,i,s,d,p,f,h,x,m;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.current.setData([]),null===(n=T.current)||void 0===n?void 0:n.value,c="\n    SELECT DISTINCT\n        DATE_FORMAT(Check_Date, '%Y-%d-%m') AS Check_Date,\n        Bank,\n        Check_No,\n        Check_Amnt,\n        ifnull(b.Status,'--') AS Status,\n        ifnull(b.RCPNo,'--') AS RCPNO \n    FROM\n        pdc a\n        left join (\n        SELECT PNNo,a.RCPNo,Status,CheckNo FROM upward_insurance_umis.pullout_request  a\n        left join pullout_request_details b on a.RCPNo = b.RCPNo\n        where PNNo = '".concat(null===(a=F.current)||void 0===a?void 0:a.value,"' and Approved_By is null and Approved_Date is null\n        ) b on a.Check_No = b.CheckNo\n    WHERE\n        PNo = '").concat(null===(u=F.current)||void 0===u?void 0:u.value,"'\n      AND PDC_Status = 'Stored'\n    \n\n        "),e.next=5,_.current(c);case 5:if(o=e.sent,l=o.data,"edit"!=E){e.next=20;break}return i="\n                    SELECT DISTINCT\n                      CheckNo\n                  FROM\n                      pullout_request a\n                          LEFT JOIN\n                      pullout_request_details b ON a.RCPNo = b.RCPNo\n                  WHERE\n                      a.PNNo = '".concat(t,"'\n                          AND Status = 'PENDING'\n                  ORDER BY CheckNo\n          "),e.next=11,_.current(i);case 11:s=e.sent,d=s.data,p=d.data.map((function(e){return e.CheckNo})),f=l.data.map((function(e,t){return p.includes(e.Check_No)?t:null})),h=f.filter((function(e){return null!==e})),A.current.setDataFormated(l.data),A.current.setSelectedRow(h),e.next=24;break;case 20:x=l.data.map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})),m=x.filter((function(e){return null!==e})),A.current.setDataFormated(l.data),A.current.setSelectedRow(m);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)},ue=function(){setTimeout((function(){T.current&&(T.current.value=""),F.current&&(F.current.value=""),I.current&&(I.current.value=""),q.current&&(q.current.selectedIndex=0)}),100)};return(0,N.jsxs)(N.Fragment,{children:[(K||U)&&(0,N.jsx)(m.g,{}),(0,N.jsx)(J,{}),(0,N.jsx)(ee,{}),(0,N.jsxs)("div",{className:"main",style:{flex:"1",display:"flex",justifyContent:"center",alignItems:"center",background:"#F1F1F1"},children:[(0,N.jsx)(C.Z,{title:"Pullout Request"}),(0,N.jsxs)("div",{className:"content",style:{padding:"10px",width:"62%",border:"1px sold black",height:"500px",boxShadow:"1px 1px 2px 2px black",display:"flex",flexDirection:"column"},children:[(0,N.jsxs)("div",{style:{height:"auto"},children:["edit"===E&&(0,N.jsx)(s.oi,{containerClassName:"custom-input",containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"RCP No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{type:"text",style:{width:"calc(100% - 100px)"},onKeyDown:function(e){"NumpadEnter"!==e.code&&"Enter"!==e.code||te(e.currentTarget.value)}},icon:(0,N.jsx)(y.Z,{sx:{fontSize:"18px"}}),onIconClick:function(e){e.preventDefault(),T.current&&te(T.current.value)},inputRef:T}),(""===E||"add"===E)&&(0,N.jsx)(s.oi,{containerClassName:"custom-input",containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"RCP No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:!0,type:"text",style:{width:"calc(100% - 100px)"},onKeyDown:function(e){"NumpadEnter"===e.code||e.code}},inputRef:T}),(0,N.jsx)(s.oi,{containerClassName:"custom-input adjust-label-search",containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"PN No. : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:""===E||"edit"===E,type:"search",onKeyDown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||(e.preventDefault(),Q(e.currentTarget.value))},style:{width:"calc(100% - 100px)",height:"22px"}},disableIcon:""===E||"edit"===E,icon:(0,N.jsx)(y.Z,{sx:{fontSize:"18px"}}),onIconClick:function(e){e.preventDefault(),F.current&&Q(F.current.value)},inputRef:F}),(0,N.jsx)(s.oi,{containerClassName:"custom-input adjust-label-search",containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"Client : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:""===E,readOnly:!0,type:"text",onKeyDown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||e.preventDefault()},style:{width:"calc(100% - 100px)",height:"22px"}},inputRef:I}),(0,N.jsx)(s.lq,{containerClassName:"custom-input",label:{title:"Reason : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:q,select:{disabled:""===E,style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(e){}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[{key:"",value:""},{key:"Fully Paid",value:"Fully Paid"},{key:"Cash Replacement",value:"Cash Replacement"},{key:"Check Replacement",value:"Check Replacement"},{key:"Account Closed",value:"Account Closed"},{key:"Hold",value:"Hold"},{key:"Not Renewed by Camfin",value:"Not Renewed by Camfin"}],values:"value",display:"key"})]}),(0,N.jsx)(d.O0,{ref:A,columns:v,rows:[],containerStyle:{flex:1},rowIsSelectable:function(e){return["APPROVED","PENDING"].includes(e[4])},getSelectedItem:function(e){},onKeyDown:function(e,t,n){},onCheckAll:function(){var e=A.current.getData().map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})).filter((function(e){return null!==e}));A.current.setSelectedRow(e)},onUnCheckAll:function(){A.current.setSelectedRow([])}}),(0,N.jsx)("div",{style:{height:"35px",display:"flex",justifyContent:"flex-end",alignItems:"center",columnGap:"5px"},children:""===E?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Z,{ref:B,variant:"contained",color:"info",style:{height:"25px",fontSize:"12px"},onClick:function(e){O("add"),ue(),z.current&&(z.current.disabled=!1),setTimeout((function(){re()}),100)},children:"Add"}),(0,N.jsx)(p.Z,{ref:M,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px",background:f.Z[800]},onClick:function(e){O("edit")},children:"edit"})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Z,{ref:z,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px"},onClick:function(e){return(g=g||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=A.current.getSelectedRowsData()).length<=0)){e.next=3;break}return e.abrupt("return",alert("No selected row found!"));case 3:if(""!==(null===(n=q.current)||void 0===n?void 0:n.value)){e.next=5;break}return e.abrupt("return",alert("Reason is required!"));case 5:(0,k.L)({isConfirm:function(){var e,t=a.map((function(e){return{Check_Date:e[0],Bank:e[1],Check_No:e[2],Check_Amnt:e[3],Status:e[4],RCPNO:e[5]}}));F.current&&I.current&&q.current&&W({flag:E,rcpn:null===(e=T.current)||void 0===e?void 0:e.value,ppno:F.current.value,name:I.current.value,reason:q.current.value,data:JSON.stringify(t)})}});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},children:"save"}),(0,N.jsx)(p.Z,{ref:L,variant:"contained",color:"error",style:{height:"25px",fontSize:"12px"},onClick:function(e){O(""),ue(),A.current.setData([])},children:"cancel"})]})})]})]})]})}}}]);
//# sourceMappingURL=8627.8e251ab0.chunk.js.map