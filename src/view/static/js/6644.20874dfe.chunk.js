"use strict";(self.webpackChunkupward=self.webpackChunkupward||[]).push([[6644],{9109:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(74165),a=n(15861),u=n(29439),o=n(39709),c=n(1441),i=n(72791),l=n(91933),s=n(3380),d=n(637),f=n(37209),h=n(11690),p=n(36151),x=n(81258),C=n(16395),v=n(21830),m=n.n(v),N=n(65413),y=n(70272),R=n(80184),w=[{key:"Check_Date",label:"Date",width:80},{key:"Bank",label:"Bank",width:150},{key:"Check_No",label:"Check No",width:150},{key:"Check_Amnt",label:"Amount",width:120},{key:"Status",label:"Status",width:150},{key:"RCPNO",label:"RCPNO",width:150}];function k(){var e,t,n,v,k,S,P=(0,i.useContext)(s.V),g=P.myAxios,D=P.user,b=(0,d.Z)().executeQueryToClient,Z=(0,i.useState)(""),E=(0,u.Z)(Z,2),j=E[0],O=E[1],_=(0,i.useState)(!1),A=(0,u.Z)(_,2),T=A[0],B=A[1],I=(0,i.useState)([]),z=(0,u.Z)(I,2),F=z[0],M=z[1],q=(0,i.useRef)(b),H=(0,i.useRef)(null),L=(0,i.useRef)(null),V=(0,i.useRef)(null),W=(0,i.useRef)(null),Y=(0,i.useRef)(null),K=(0,i.useRef)(null),G=(0,i.useRef)(null),U=(0,i.useRef)(null),J=(0,i.useRef)(null),Q=(0,i.useRef)(null),X=(0,i.useRef)(null),$=(0,l.useMutation)({mutationKey:"save-pullout-request",mutationFn:function(t){return(e=e||(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.post("/task/accounting/pullout/reqeust/save-pullout-request",t,{headers:{Authorization:"Bearer ".concat(null===D||void 0===D?void 0:D.accessToken)}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},onSuccess:function(e,t){var n=e;return n.data.success?(ae(t.ppno),re(),m().fire({position:"center",icon:"success",title:n.data.message,timer:1500})):m().fire({position:"center",icon:"warning",title:n.data.message,timer:1500})}}),ee=$.isLoading,te=$.mutate,ne=(0,i.useCallback)((0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(!0),"SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC",e.next=4,q.current("SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC");case 4:t=e.sent,n=t.data,M(n.data),B(!1);case 8:case"end":return e.stop()}}),e)}))),[]),re=function(){return(n=n||(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'",e.next=3,q.current("\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'");case 3:t=e.sent,n=t.data,W.current&&(W.current.value="HOPO".concat(n.data[0].Year).concat(n.data[0].Count));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},ae=function(e){return(v=v||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,o,c,i,l,s,d,f,h,p,x,C;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.current.setData([]),u="add"===j?null===(n=W.current)||void 0===n?void 0:n.value:null===(a=V.current)||void 0===a?void 0:a.value,o="\n          SELECT DISTINCT\n                    date_format(Check_Date,'%Y-%d-%m') as Check_Date,\n                    Bank,\n                    Check_No,\n                    Check_Amnt,\n                    ifnull(c.Status,'--') as Status,\n                    ifnull(c.RCPNo,'--') as RCPNO\n                FROM\n                    PDC a\n                    left join pullout_request_details b on a.Check_No = b.CheckNo\n\t\t\t\t\tleft join pullout_request c on b.RCPNo = c.RCPNo\n                WHERE\n                    PNo = '".concat(t,"'\n\t\t\t\t\tAND PDC_Status = 'Stored'\n                ORDER BY Check_No\n        "),e.next=5,q.current(o);case 5:if(c=e.sent,i=c.data,"edit"!=j){e.next=20;break}return l="\n            SELECT DISTINCT\n                      Check_No\n                  FROM\n                      PDC a\n                      left join pullout_request_details b on a.Check_No = b.CheckNo    \n                      left join pullout_request c on b.RCPNo = c.RCPNo   \n                  WHERE\n                      PNo = '".concat(t,"'\n                      AND PDC_Status = 'Stored'\n                      AND c.Status is not null\n                      AND c.RCPNo = '").concat(u,"'\n                  ORDER BY Check_No\n          "),e.next=11,q.current(l);case 11:s=e.sent,d=s.data,f=d.data.map((function(e){return e.Check_No})),h=i.data.map((function(e,t){return f.includes(e.Check_No)?t:null})),p=h.filter((function(e){return null!==e})),H.current.setDataFormated(i.data),H.current.setSelectedRow(p),e.next=24;break;case 20:x=i.data.map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})),C=x.filter((function(e){return null!==e})),H.current.setDataFormated(i.data),H.current.setSelectedRow(C);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)},ue=function(){setTimeout((function(){W.current&&(W.current.value=""),Y.current&&(Y.current.value=""),K.current&&(K.current.value=""),G.current&&(G.current.selectedIndex=0)}),100)};return(0,i.useEffect)((function(){ne()}),[ne]),(0,R.jsxs)("div",{style:{flex:"1",display:"flex",justifyContent:"center",alignItems:"center",background:"#F1F1F1"},children:[(0,R.jsx)(y.Z,{title:"Pullout Request"}),ee&&(0,R.jsx)(N.g,{}),(0,R.jsxs)("div",{style:{padding:"10px",width:"62%",border:"1px sold black",height:"500px",boxShadow:"1px 1px 2px 2px black",display:"flex",flexDirection:"column"},children:[(0,R.jsxs)("div",{style:{height:"auto"},children:["edit"===j&&(T?(0,R.jsx)(o.Z,{loading:T}):(0,R.jsx)("div",{style:{width:"100%",marginBottom:"8px"},children:(0,R.jsx)(f.lq,{ref:L,label:{title:"RCP No.  : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:V,select:{style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(e){return(k=k||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("edit"!==j){e.next=7;break}return n="\n                                                Select \n                                                        *,\n                                                        (selecT distinct(name) from pdc where PNo =a.PNNo) as 'Name'\n                                                    From PullOut_Request a \n                                                    Where Branch = 'HO' and Status = 'PENDING' and rcpno = '".concat(t.currentTarget.value,"' \n                                                    Order by RCPNo\n                                                "),e.next=4,q.current(n);case 4:a=e.sent,(u=a.data).data.length>0?(0,C.wait)(100).then((function(){Y.current&&(Y.current.value=u.data[0].PNNo),K.current&&(K.current.value=u.data[0].Name),G.current&&(G.current.value=u.data[0].Reason),ae(u.data[0].PNNo)})):(H.current.setData([]),ue());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[],values:"RCPNo",display:"RCPNo"})})),(""===j||"add"===j)&&(0,R.jsx)(f.oi,{containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"RCP No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:!0,type:"text",style:{width:"calc(100% - 100px)"},onKeyDown:function(e){"NumpadEnter"===e.code||e.code}},inputRef:W}),T?(0,R.jsx)(o.Z,{loading:T}):(0,R.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,R.jsx)(c.Autocomplete,{disableInput:""===j||"edit"===j,label:{title:"PN No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"PNo",DataSource:F,inputRef:Y,onChange:function(e,t){Y.current&&(Y.current.value=e.PNo),K.current&&(K.current.value=e.Name),G.current&&G.current.selectedIndex>0&&ae(e.PNo)},onKeydown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||e.preventDefault()}})}),T?(0,R.jsx)(o.Z,{loading:T}):(0,R.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,R.jsx)(c.Autocomplete,{disableInput:""===j||"edit"===j,label:{title:"Client :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"Name",DataSource:F,inputRef:K,onChange:function(e,t){Y.current&&(Y.current.value=e.PNo),K.current&&(K.current.value=e.Name),G.current&&G.current.selectedIndex>0&&ae(e.PNo)},onKeydown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||e.preventDefault()}})}),(0,R.jsx)(f.lq,{label:{title:"Reason : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:G,select:{disabled:""===j,style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(e){Y.current&&ae(Y.current.value)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[{key:"",value:""},{key:"Fully Paid",value:"Fully Paid"},{key:"Cash Replacement",value:"Cash Replacement"},{key:"Check Replacement",value:"Check Replacement"},{key:"Account Closed",value:"Account Closed"},{key:"Hold",value:"Hold"},{key:"Not Renewed by Camfin",value:"Not Renewed by Camfin"}],values:"value",display:"key"})]}),(0,R.jsx)(h.O0,{ref:H,columns:w,rows:[],containerStyle:{flex:1},rowIsSelectable:function(e){return["APPROVED","PENDING"].includes(e[4])},getSelectedItem:function(e){},onKeyDown:function(e,t,n){},onCheckAll:function(){var e=H.current.getData().map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})).filter((function(e){return null!==e}));H.current.setSelectedRow(e)},onUnCheckAll:function(){H.current.setSelectedRow([])}}),(0,R.jsx)("div",{style:{height:"35px",display:"flex",justifyContent:"flex-end",alignItems:"center",columnGap:"5px"},children:""===j?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(p.Z,{ref:U,variant:"contained",color:"info",style:{height:"25px",fontSize:"12px"},onClick:function(e){O("add"),ue(),Q.current&&(Q.current.disabled=!1),setTimeout((function(){re()}),100)},children:"Add"}),(0,R.jsx)(p.Z,{ref:J,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px",background:x.Z[800]},onClick:function(e){O("edit"),function(){(t=t||(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,q.current("\n        select '' as RCPNo\n        union \n        SELECT DISTINCT\n            (RCPNo)\n        FROM\n            PullOut_Request\n        WHERE\n            Branch = 'HO' AND Status = 'PENDING'\n        ORDER BY RCPNo\n        ");case 3:t=e.sent,n=t.data,(0,C.wait)(100).then((function(){L.current.setDataSource(n.data)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()},children:"edit"})]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(p.Z,{ref:Q,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px"},onClick:function(e){return(S=S||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,o,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=H.current.getSelectedRowsData()).length<=0)){e.next=3;break}return e.abrupt("return",alert("No selected row found!"));case 3:a=n.map((function(e){return{Check_Date:e[0],Bank:e[1],Check_No:e[2],Check_Amnt:e[3],Status:e[4],RCPNO:e[5]}})),Y.current&&K.current&&G.current&&(c="add"===j?null===(u=W.current)||void 0===u?void 0:u.value:null===(o=V.current)||void 0===o?void 0:o.value,te({flag:j,rcpn:c,ppno:Y.current.value,name:K.current.value,reason:G.current.value,data:JSON.stringify(a)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)},children:"save"}),(0,R.jsx)(p.Z,{ref:X,variant:"contained",color:"error",style:{height:"25px",fontSize:"12px"},onClick:function(e){O(""),ue(),H.current.setData([])},children:"cancel"})]})})]})]})}},64230:function(e,t,n){n.d(t,{L:function(){return i},s:function(){return c}});var r=n(74165),a=n(15861),u=n(21830),o=n.n(u);function c(e){var t;o().fire({title:"Are you sure!",html:null!==e&&void 0!==e&&e.text?null===e||void 0===e?void 0:e.text:e.isUpdate?"Are you sure you want to make this change?":"Are you sure you want to delete this?",icon:"warning",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Save",confirmButtonColor:"green",showLoaderOnConfirm:!0,preConfirm:function(n){return(t=t||(0,a.Z)((0,r.Z)().mark((function t(n){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{e.cb(n)}catch(r){o().showValidationMessage("\n            Request failed: ".concat(r,"\n          "))}case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)},allowOutsideClick:function(){return!o().isLoading()}}).then((function(t){if(t.isConfirmed&&e.isConfirm)return e.isConfirm();e.isDeclined&&e.isDeclined()}))}function i(e){o().fire({title:"Are you sure?",text:null!==e&&void 0!==e&&e.text?null===e||void 0===e?void 0:e.text:"Do you want to proceed with saving?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, save it!"}).then((function(t){if(t.isConfirmed&&e.isConfirm)return e.isConfirm();e.isDeclined&&e.isDeclined()}))}},42419:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),u=n(80184),o=(0,a.default)((0,u.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");t.Z=o},85172:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),u=n(80184),o=(0,a.default)((0,u.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");t.Z=o},91421:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),u=n(80184),o=(0,a.default)([(0,u.jsx)("circle",{cx:"10",cy:"8",r:"4"},"0"),(0,u.jsx)("path",{d:"M10.35 14.01C7.62 13.91 2 15.27 2 18v2h9.54c-2.47-2.76-1.23-5.89-1.19-5.99zm9.08 4.01c.36-.59.57-1.28.57-2.02 0-2.21-1.79-4-4-4s-4 1.79-4 4 1.79 4 4 4c.74 0 1.43-.22 2.02-.57L20.59 22 22 20.59l-2.57-2.57zM16 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"},"1")],"PersonSearch");t.Z=o},86753:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),u=n(80184),o=(0,a.default)((0,u.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"}),"RestartAlt");t.Z=o},53329:function(e,t,n){var r=n(64836);t.Z=void 0;var a=r(n(45649)),u=n(80184),o=(0,a.default)((0,u.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"}),"Save");t.Z=o}}]);
//# sourceMappingURL=6644.20874dfe.chunk.js.map