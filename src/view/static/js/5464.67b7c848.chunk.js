"use strict";(self.webpackChunkupward=self.webpackChunkupward||[]).push([[5464],{9109:function(t,n,e){e.r(n),e.d(n,{default:function(){return R}});var a=e(74165),o=e(15861),r=e(29439),i=e(39709),c=e(1441),u=e(72791),l=e(91933),s=e(3380),d=e(637),f=e(15703),h=e(11690),p=e(36151),g=e(81258),v=e(16395),x=e(21830),C=e.n(x),m=e(65413),y=e(70272),N=e(80184),w=[{key:"Check_Date",label:"Date",width:80},{key:"Bank",label:"Bank",width:150},{key:"Check_No",label:"Check No",width:150},{key:"Check_Amnt",label:"Amount",width:120},{key:"Status",label:"Status",width:150},{key:"RCPNO",label:"RCPNO",width:150}];function R(){var t,n,e,x,R,P,S=(0,u.useContext)(s.V),k=S.myAxios,b=S.user,Z=(0,d.Z)().executeQueryToClient,D=(0,u.useState)(""),I=(0,r.Z)(D,2),E=I[0],O=I[1],L=(0,u.useState)(!1),j=(0,r.Z)(L,2),_=j[0],B=j[1],T=(0,u.useState)([]),A=(0,r.Z)(T,2),F=A[0],M=A[1],q=(0,u.useRef)(Z),W=(0,u.useRef)(null),z=(0,u.useRef)(null),H=(0,u.useRef)(null),V=(0,u.useRef)(null),Y=(0,u.useRef)(null),K=(0,u.useRef)(null),G=(0,u.useRef)(null),U=(0,u.useRef)(null),J=(0,u.useRef)(null),Q=(0,u.useRef)(null),X=(0,u.useRef)(null),$=(0,l.useMutation)({mutationKey:"save-pullout-request",mutationFn:function(n){return(t=t||(0,o.Z)((0,a.Z)().mark((function t(n){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,k.post("/task/accounting/pullout/reqeust/save-pullout-request",n,{headers:{Authorization:"Bearer ".concat(null===b||void 0===b?void 0:b.accessToken)}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)},onSuccess:function(t,n){var e=t;return e.data.success?(ot(n.ppno),at(),C().fire({position:"center",icon:"success",title:e.data.message,timer:1500})):C().fire({position:"center",icon:"warning",title:e.data.message,timer:1500})}}),tt=$.isLoading,nt=$.mutate,et=(0,u.useCallback)((0,o.Z)((0,a.Z)().mark((function t(){var n,e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return B(!0),"SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC",t.next=4,q.current("SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC");case 4:n=t.sent,e=n.data,M(e.data),B(!1);case 8:case"end":return t.stop()}}),t)}))),[]),at=function(){return(e=e||(0,o.Z)((0,a.Z)().mark((function t(){var n,e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'",t.next=3,q.current("\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'");case 3:n=t.sent,e=n.data,V.current&&(V.current.value="HOPO".concat(e.data[0].Year).concat(e.data[0].Count));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)},ot=function(t){return(x=x||(0,o.Z)((0,a.Z)().mark((function t(n){var e,o,r,i,c,u,l,s,d,f,h,p,g,v;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return W.current.setData([]),r="add"===E?null===(e=V.current)||void 0===e?void 0:e.value:null===(o=H.current)||void 0===o?void 0:o.value,i="\n          SELECT DISTINCT\n                    date_format(Check_Date,'%Y-%d-%m') as Check_Date,\n                    Bank,\n                    Check_No,\n                    Check_Amnt,\n                    ifnull(c.Status,'--') as Status,\n                    ifnull(c.RCPNo,'--') as RCPNO\n                FROM\n                    PDC a\n                    left join pullout_request_details b on a.Check_No = b.CheckNo\n\t\t\t\t\tleft join pullout_request c on b.RCPNo = c.RCPNo\n                WHERE\n                    PNo = '".concat(n,"'\n\t\t\t\t\tAND PDC_Status = 'Stored'\n                ORDER BY Check_No\n        "),t.next=5,q.current(i);case 5:if(c=t.sent,u=c.data,"edit"!=E){t.next=20;break}return l="\n            SELECT DISTINCT\n                      Check_No\n                  FROM\n                      PDC a\n                      left join pullout_request_details b on a.Check_No = b.CheckNo    \n                      left join pullout_request c on b.RCPNo = c.RCPNo   \n                  WHERE\n                      PNo = '".concat(n,"'\n                      AND PDC_Status = 'Stored'\n                      AND c.Status is not null\n                      AND c.RCPNo = '").concat(r,"'\n                  ORDER BY Check_No\n          "),t.next=11,q.current(l);case 11:s=t.sent,d=s.data,f=d.data.map((function(t){return t.Check_No})),h=u.data.map((function(t,n){return f.includes(t.Check_No)?n:null})),p=h.filter((function(t){return null!==t})),W.current.setDataFormated(u.data),W.current.setSelectedRow(p),t.next=24;break;case 20:g=u.data.map((function(t,n){return"--"!==t.RCPNO&&""!==t.RCPNO&&"APPROVED"!==t.Status?n:null})),v=g.filter((function(t){return null!==t})),W.current.setDataFormated(u.data),W.current.setSelectedRow(v);case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)},rt=function(){setTimeout((function(){V.current&&(V.current.value=""),Y.current&&(Y.current.value=""),K.current&&(K.current.value=""),G.current&&(G.current.selectedIndex=0)}),100)};return(0,u.useEffect)((function(){et()}),[et]),(0,N.jsxs)("div",{style:{flex:"1",display:"flex",justifyContent:"center",alignItems:"center",background:"#F1F1F1"},children:[(0,N.jsx)(y.Z,{title:"Pullout Request"}),tt&&(0,N.jsx)(m.g,{}),(0,N.jsxs)("div",{style:{padding:"10px",width:"62%",border:"1px sold black",height:"500px",boxShadow:"1px 1px 2px 2px black",display:"flex",flexDirection:"column"},children:[(0,N.jsxs)("div",{style:{height:"auto"},children:["edit"===E&&(_?(0,N.jsx)(i.Z,{loading:_}):(0,N.jsx)("div",{style:{width:"100%",marginBottom:"8px"},children:(0,N.jsx)(f.lq,{ref:z,label:{title:"RCP No.  : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:H,select:{style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(t){return(R=R||(0,o.Z)((0,a.Z)().mark((function t(n){var e,o,r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("edit"!==E){t.next=7;break}return e="\n                                                Select \n                                                        *,\n                                                        (selecT distinct(name) from pdc where PNo =a.PNNo) as 'Name'\n                                                    From PullOut_Request a \n                                                    Where Branch = 'HO' and Status = 'PENDING' and rcpno = '".concat(n.currentTarget.value,"' \n                                                    Order by RCPNo\n                                                "),t.next=4,q.current(e);case 4:o=t.sent,(r=o.data).data.length>0?(0,v.wait)(100).then((function(){Y.current&&(Y.current.value=r.data[0].PNNo),K.current&&(K.current.value=r.data[0].Name),G.current&&(G.current.value=r.data[0].Reason),ot(r.data[0].PNNo)})):(W.current.setData([]),rt());case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[],values:"RCPNo",display:"RCPNo"})})),(""===E||"add"===E)&&(0,N.jsx)(f.oi,{containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"RCP No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:!0,type:"text",style:{width:"calc(100% - 100px)"},onKeyDown:function(t){"NumpadEnter"===t.code||t.code}},inputRef:V}),_?(0,N.jsx)(i.Z,{loading:_}):(0,N.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,N.jsx)(c.Autocomplete,{disableInput:""===E||"edit"===E,label:{title:"PN No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"PNo",DataSource:F,inputRef:Y,onChange:function(t,n){Y.current&&(Y.current.value=t.PNo),K.current&&(K.current.value=t.Name),G.current&&G.current.selectedIndex>0&&ot(t.PNo)},onKeydown:function(t){"Enter"!==t.key&&"NumpadEnter"!==t.key||t.preventDefault()}})}),_?(0,N.jsx)(i.Z,{loading:_}):(0,N.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,N.jsx)(c.Autocomplete,{disableInput:""===E||"edit"===E,label:{title:"Client :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"Name",DataSource:F,inputRef:K,onChange:function(t,n){Y.current&&(Y.current.value=t.PNo),K.current&&(K.current.value=t.Name),G.current&&G.current.selectedIndex>0&&ot(t.PNo)},onKeydown:function(t){"Enter"!==t.key&&"NumpadEnter"!==t.key||t.preventDefault()}})}),(0,N.jsx)(f.lq,{label:{title:"Reason : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:G,select:{disabled:""===E,style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(t){Y.current&&ot(Y.current.value)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[{key:"",value:""},{key:"Fully Paid",value:"Fully Paid"},{key:"Cash Replacement",value:"Cash Replacement"},{key:"Check Replacement",value:"Check Replacement"},{key:"Account Closed",value:"Account Closed"},{key:"Hold",value:"Hold"},{key:"Not Renewed by Camfin",value:"Not Renewed by Camfin"}],values:"value",display:"key"})]}),(0,N.jsx)(h.O0,{ref:W,columns:w,rows:[],containerStyle:{flex:1},rowIsSelectable:function(t){return["APPROVED","PENDING"].includes(t[4])},getSelectedItem:function(t){},onKeyDown:function(t,n,e){},onCheckAll:function(){var t=W.current.getData().map((function(t,n){return"--"!==t.RCPNO&&""!==t.RCPNO&&"APPROVED"!==t.Status?n:null})).filter((function(t){return null!==t}));W.current.setSelectedRow(t)},onUnCheckAll:function(){W.current.setSelectedRow([])}}),(0,N.jsx)("div",{style:{height:"35px",display:"flex",justifyContent:"flex-end",alignItems:"center",columnGap:"5px"},children:""===E?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Z,{ref:U,variant:"contained",color:"info",style:{height:"25px",fontSize:"12px"},onClick:function(t){O("add"),rt(),Q.current&&(Q.current.disabled=!1),setTimeout((function(){at()}),100)},children:"Add"}),(0,N.jsx)(p.Z,{ref:J,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px",background:g.Z[800]},onClick:function(t){O("edit"),function(){(n=n||(0,o.Z)((0,a.Z)().mark((function t(){var n,e;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,q.current("\n        select '' as RCPNo\n        union \n        SELECT DISTINCT\n            (RCPNo)\n        FROM\n            PullOut_Request\n        WHERE\n            Branch = 'HO' AND Status = 'PENDING'\n        ORDER BY RCPNo\n        ");case 3:n=t.sent,e=n.data,(0,v.wait)(100).then((function(){z.current.setDataSource(e.data)}));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}()},children:"edit"})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(p.Z,{ref:Q,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px"},onClick:function(t){return(P=P||(0,o.Z)((0,a.Z)().mark((function t(n){var e,o,r,i,c;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((e=W.current.getSelectedRowsData()).length<=0)){t.next=3;break}return t.abrupt("return",alert("No selected row found!"));case 3:o=e.map((function(t){return{Check_Date:t[0],Bank:t[1],Check_No:t[2],Check_Amnt:t[3],Status:t[4],RCPNO:t[5]}})),Y.current&&K.current&&G.current&&(c="add"===E?null===(r=V.current)||void 0===r?void 0:r.value:null===(i=H.current)||void 0===i?void 0:i.value,nt({flag:E,rcpn:c,ppno:Y.current.value,name:K.current.value,reason:G.current.value,data:JSON.stringify(o)}));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)},children:"save"}),(0,N.jsx)(p.Z,{ref:X,variant:"contained",color:"error",style:{height:"25px",fontSize:"12px"},onClick:function(t){O(""),rt(),W.current.setData([])},children:"cancel"})]})})]})]})}},64230:function(t,n,e){e.d(n,{L:function(){return u},s:function(){return c}});var a=e(74165),o=e(15861),r=e(21830),i=e.n(r);function c(t){var n;i().fire({title:"Are you sure!",html:null!==t&&void 0!==t&&t.text?null===t||void 0===t?void 0:t.text:t.isUpdate?"Are you sure you want to make this change?":"Are you sure you want to delete this?",icon:"warning",input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Save",confirmButtonColor:"green",showLoaderOnConfirm:!0,preConfirm:function(e){return(n=n||(0,o.Z)((0,a.Z)().mark((function n(e){return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:try{t.cb(e)}catch(a){i().showValidationMessage("\n            Request failed: ".concat(a,"\n          "))}case 1:case"end":return n.stop()}}),n)})))).apply(this,arguments)},allowOutsideClick:function(){return!i().isLoading()}}).then((function(n){if(n.isConfirmed&&t.isConfirm)return t.isConfirm();t.isDeclined&&t.isDeclined()}))}function u(t){i().fire({title:"Are you sure?",text:null!==t&&void 0!==t&&t.text?null===t||void 0===t?void 0:t.text:"Do you want to proceed with saving?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, save it!"}).then((function(n){if(n.isConfirmed&&t.isConfirm)return t.isConfirm();t.isDeclined&&t.isDeclined()}))}},39709:function(t,n,e){e.d(n,{Z:function(){return N}});var a=e(4942),o=e(63366),r=e(87462),i=e(72791),c=e(14036),u=e(67384),l=e(94419),s=e(66934),d=e(31402),f=e(36151),h=e(13239),p=e(21217);function g(t){return(0,p.Z)("MuiLoadingButton",t)}var v=(0,e(75878).Z)("MuiLoadingButton",["root","loading","loadingIndicator","loadingIndicatorCenter","loadingIndicatorStart","loadingIndicatorEnd","endIconLoadingEnd","startIconLoadingStart"]),x=e(80184),C=["children","disabled","id","loading","loadingIndicator","loadingPosition","variant"],m=(0,s.ZP)(f.Z,{shouldForwardProp:function(t){return function(t){return"ownerState"!==t&&"theme"!==t&&"sx"!==t&&"as"!==t&&"classes"!==t}(t)||"classes"===t},name:"MuiLoadingButton",slot:"Root",overridesResolver:function(t,n){return[n.root,n.startIconLoadingStart&&(0,a.Z)({},"& .".concat(v.startIconLoadingStart),n.startIconLoadingStart),n.endIconLoadingEnd&&(0,a.Z)({},"& .".concat(v.endIconLoadingEnd),n.endIconLoadingEnd)]}})((function(t){var n=t.ownerState,e=t.theme;return(0,r.Z)((0,a.Z)({},"& .".concat(v.startIconLoadingStart,", & .").concat(v.endIconLoadingEnd),{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0}),"center"===n.loadingPosition&&(0,a.Z)({transition:e.transitions.create(["background-color","box-shadow","border-color"],{duration:e.transitions.duration.short})},"&.".concat(v.loading),{color:"transparent"}),"start"===n.loadingPosition&&n.fullWidth&&(0,a.Z)({},"& .".concat(v.startIconLoadingStart,", & .").concat(v.endIconLoadingEnd),{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginRight:-8}),"end"===n.loadingPosition&&n.fullWidth&&(0,a.Z)({},"& .".concat(v.startIconLoadingStart,", & .").concat(v.endIconLoadingEnd),{transition:e.transitions.create(["opacity"],{duration:e.transitions.duration.short}),opacity:0,marginLeft:-8}))})),y=(0,s.ZP)("span",{name:"MuiLoadingButton",slot:"LoadingIndicator",overridesResolver:function(t,n){var e=t.ownerState;return[n.loadingIndicator,n["loadingIndicator".concat((0,c.Z)(e.loadingPosition))]]}})((function(t){var n=t.theme,e=t.ownerState;return(0,r.Z)({position:"absolute",visibility:"visible",display:"flex"},"start"===e.loadingPosition&&("outlined"===e.variant||"contained"===e.variant)&&{left:"small"===e.size?10:14},"start"===e.loadingPosition&&"text"===e.variant&&{left:6},"center"===e.loadingPosition&&{left:"50%",transform:"translate(-50%)",color:(n.vars||n).palette.action.disabled},"end"===e.loadingPosition&&("outlined"===e.variant||"contained"===e.variant)&&{right:"small"===e.size?10:14},"end"===e.loadingPosition&&"text"===e.variant&&{right:6},"start"===e.loadingPosition&&e.fullWidth&&{position:"relative",left:-10},"end"===e.loadingPosition&&e.fullWidth&&{position:"relative",right:-10})})),N=i.forwardRef((function(t,n){var e=(0,d.Z)({props:t,name:"MuiLoadingButton"}),a=e.children,i=e.disabled,s=void 0!==i&&i,f=e.id,p=e.loading,v=void 0!==p&&p,N=e.loadingIndicator,w=e.loadingPosition,R=void 0===w?"center":w,P=e.variant,S=void 0===P?"text":P,k=(0,o.Z)(e,C),b=(0,u.Z)(f),Z=null!=N?N:(0,x.jsx)(h.Z,{"aria-labelledby":b,color:"inherit",size:16}),D=(0,r.Z)({},e,{disabled:s,loading:v,loadingIndicator:Z,loadingPosition:R,variant:S}),I=function(t){var n=t.loading,e=t.loadingPosition,a=t.classes,o={root:["root",n&&"loading"],startIcon:[n&&"startIconLoading".concat((0,c.Z)(e))],endIcon:[n&&"endIconLoading".concat((0,c.Z)(e))],loadingIndicator:["loadingIndicator",n&&"loadingIndicator".concat((0,c.Z)(e))]},i=(0,l.Z)(o,g,a);return(0,r.Z)({},a,i)}(D),E=v?(0,x.jsx)(y,{className:I.loadingIndicator,ownerState:D,children:Z}):null;return(0,x.jsxs)(m,(0,r.Z)({disabled:s||v,id:b,ref:n},k,{variant:S,classes:I,ownerState:D,children:["end"===D.loadingPosition?a:E,"end"===D.loadingPosition?E:a]}))}))}}]);
//# sourceMappingURL=5464.67b7c848.chunk.js.map