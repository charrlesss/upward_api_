"use strict";(self.webpackChunkupward=self.webpackChunkupward||[]).push([[8535,7899],{9109:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(74165),a=n(15861),u=n(29439),c=n(39709),o=n(1441),l=n(72791),i=n(91933),s=n(3380),d=n(637),f=n(37209),p=n(11690),h=n(36151),C=n(81258),x=n(16395),N=n(21830),y=n.n(N),R=n(65413),m=n(80184),v=[{key:"Check_Date",label:"Date",width:80},{key:"Bank",label:"Bank",width:150},{key:"Check_No",label:"Check No",width:150},{key:"Check_Amnt",label:"Amount",width:120},{key:"Status",label:"Status",width:150},{key:"RCPNO",label:"RCPNO",width:150}];function k(){var e,t,n,N,k,w,P=(0,l.useContext)(s.V),S=P.myAxios,g=P.user,b=(0,d.Z)().executeQueryToClient,D=(0,l.useState)(""),E=(0,u.Z)(D,2),O=E[0],Z=E[1],_=(0,l.useState)(!1),j=(0,u.Z)(_,2),T=j[0],A=j[1],I=(0,l.useState)([]),B=(0,u.Z)(I,2),F=B[0],q=B[1],H=(0,l.useRef)(b),W=(0,l.useRef)(null),z=(0,l.useRef)(null),M=(0,l.useRef)(null),L=(0,l.useRef)(null),V=(0,l.useRef)(null),Y=(0,l.useRef)(null),K=(0,l.useRef)(null),G=(0,l.useRef)(null),U=(0,l.useRef)(null),J=(0,l.useRef)(null),Q=(0,l.useRef)(null),X=(0,i.useMutation)({mutationKey:"save-pullout-request",mutationFn:function(t){return(e=e||(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.post("/task/accounting/pullout/reqeust/save-pullout-request",t,{headers:{Authorization:"Bearer ".concat(null===g||void 0===g?void 0:g.accessToken)}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},onSuccess:function(e,t){var n=e;return n.data.success?(re(t.ppno),ne(),y().fire({position:"center",icon:"success",title:n.data.message,timer:1500})):y().fire({position:"center",icon:"warning",title:n.data.message,timer:1500})}}),$=X.isLoading,ee=X.mutate,te=(0,l.useCallback)((0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!0),"SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC",e.next=4,H.current("SELECT DISTINCT PNo, Name FROM PDC WHERE PDC_Status = 'Stored' order by PNo DESC");case 4:t=e.sent,n=t.data,q(n.data),A(!1);case 8:case"end":return e.stop()}}),e)}))),[]),ne=function(){return(n=n||(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'",e.next=3,H.current("\n        SELECT\n            right(year(curdate()) ,2) as Year,\n            lpad(COUNT(1) + 1, 4, '0') as Count\n        FROM pullout_request\n            where substring(RCPNo,5,2) = right(year(curdate()) ,2) and Branch = 'HO'");case 3:t=e.sent,n=t.data,L.current&&(L.current.value="HOPO".concat(n.data[0].Year).concat(n.data[0].Count));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},re=function(e){return(N=N||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,c,o,l,i,s,d,f,p,h,C,x;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W.current.setData([]),u="add"===O?null===(n=L.current)||void 0===n?void 0:n.value:null===(a=M.current)||void 0===a?void 0:a.value,c="\n          SELECT DISTINCT\n                    date_format(Check_Date,'%Y-%d-%m') as Check_Date,\n                    Bank,\n                    Check_No,\n                    Check_Amnt,\n                    ifnull(c.Status,'--') as Status,\n                    ifnull(c.RCPNo,'--') as RCPNO\n                FROM\n                    PDC a\n                    left join pullout_request_details b on a.Check_No = b.CheckNo\n\t\t\t\t\tleft join pullout_request c on b.RCPNo = c.RCPNo\n                WHERE\n                    PNo = '".concat(t,"'\n\t\t\t\t\tAND PDC_Status = 'Stored'\n                ORDER BY Check_No\n        "),e.next=5,H.current(c);case 5:if(o=e.sent,l=o.data,"edit"!=O){e.next=20;break}return i="\n            SELECT DISTINCT\n                      Check_No\n                  FROM\n                      PDC a\n                      left join pullout_request_details b on a.Check_No = b.CheckNo    \n                      left join pullout_request c on b.RCPNo = c.RCPNo   \n                  WHERE\n                      PNo = '".concat(t,"'\n                      AND PDC_Status = 'Stored'\n                      AND c.Status is not null\n                      AND c.RCPNo = '").concat(u,"'\n                  ORDER BY Check_No\n          "),e.next=11,H.current(i);case 11:s=e.sent,d=s.data,f=d.data.map((function(e){return e.Check_No})),p=l.data.map((function(e,t){return f.includes(e.Check_No)?t:null})),h=p.filter((function(e){return null!==e})),W.current.setDataFormated(l.data),W.current.setSelectedRow(h),e.next=24;break;case 20:C=l.data.map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})),x=C.filter((function(e){return null!==e})),W.current.setDataFormated(l.data),W.current.setSelectedRow(x);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)},ae=function(){setTimeout((function(){L.current&&(L.current.value=""),V.current&&(V.current.value=""),Y.current&&(Y.current.value=""),K.current&&(K.current.selectedIndex=0)}),100)};return(0,l.useEffect)((function(){te()}),[te]),(0,m.jsxs)("div",{style:{flex:"1",display:"flex",justifyContent:"center",alignItems:"center",background:"#F1F1F1"},children:[$&&(0,m.jsx)(R.g,{}),(0,m.jsxs)("div",{style:{padding:"10px",width:"62%",border:"1px sold black",height:"500px",boxShadow:"1px 1px 2px 2px black",display:"flex",flexDirection:"column"},children:[(0,m.jsxs)("div",{style:{height:"auto"},children:["edit"===O&&(T?(0,m.jsx)(c.Z,{loading:T}):(0,m.jsx)("div",{style:{width:"100%",marginBottom:"8px"},children:(0,m.jsx)(f.lq,{ref:z,label:{title:"RCP No.  : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:M,select:{style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(e){return(k=k||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("edit"!==O){e.next=7;break}return n="\n                                                Select \n                                                        *,\n                                                        (selecT distinct(name) from pdc where PNo =a.PNNo) as 'Name'\n                                                    From PullOut_Request a \n                                                    Where Branch = 'HO' and Status = 'PENDING' and rcpno = '".concat(t.currentTarget.value,"' \n                                                    Order by RCPNo\n                                                "),e.next=4,H.current(n);case 4:a=e.sent,(u=a.data).data.length>0?(0,x.wait)(100).then((function(){V.current&&(V.current.value=u.data[0].PNNo),Y.current&&(Y.current.value=u.data[0].Name),K.current&&(K.current.value=u.data[0].Reason),re(u.data[0].PNNo)})):(W.current.setData([]),ae());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[],values:"RCPNo",display:"RCPNo"})})),(""===O||"add"===O)&&(0,m.jsx)(f.oi,{containerStyle:{width:"50%",marginBottom:"8px"},label:{title:"RCP No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{disabled:!0,type:"text",style:{width:"calc(100% - 100px)"},onKeyDown:function(e){"NumpadEnter"===e.code||e.code}},inputRef:L}),T?(0,m.jsx)(c.Z,{loading:T}):(0,m.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,m.jsx)(o.Autocomplete,{disableInput:""===O||"edit"===O,label:{title:"PN No. :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"PNo",DataSource:F,inputRef:V,onChange:function(e,t){V.current&&(V.current.value=e.PNo),Y.current&&(Y.current.value=e.Name),K.current&&K.current.selectedIndex>0&&re(e.PNo)},onKeydown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||e.preventDefault()}})}),T?(0,m.jsx)(c.Z,{loading:T}):(0,m.jsx)("div",{style:{width:"50%",marginBottom:"8px"},children:(0,m.jsx)(o.Autocomplete,{disableInput:""===O||"edit"===O,label:{title:"Client :",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},input:{id:"auto-solo-collection",style:{width:"100%",flex:1}},width:"100%",DisplayMember:"Name",DataSource:F,inputRef:Y,onChange:function(e,t){V.current&&(V.current.value=e.PNo),Y.current&&(Y.current.value=e.Name),K.current&&K.current.selectedIndex>0&&re(e.PNo)},onKeydown:function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||e.preventDefault()}})}),(0,m.jsx)(f.lq,{label:{title:"Reason : ",style:{fontSize:"12px",fontWeight:"bold",width:"100px"}},selectRef:K,select:{disabled:""===O,style:{flex:1,height:"22px"},defaultValue:"Non-VAT",onChange:function(e){V.current&&re(V.current.value)}},containerStyle:{width:"50%",marginBottom:"12px"},datasource:[{key:"",value:""},{key:"Fully Paid",value:"Fully Paid"},{key:"Cash Replacement",value:"Cash Replacement"},{key:"Check Replacement",value:"Check Replacement"},{key:"Account Closed",value:"Account Closed"},{key:"Hold",value:"Hold"},{key:"Not Renewed by Camfin",value:"Not Renewed by Camfin"}],values:"value",display:"key"})]}),(0,m.jsx)(p.O0,{ref:W,columns:v,rows:[],containerStyle:{flex:1},rowIsSelectable:function(e){return["APPROVED","PENDING"].includes(e[4])},getSelectedItem:function(e){},onKeyDown:function(e,t,n){},onCheckAll:function(){var e=W.current.getData().map((function(e,t){return"--"!==e.RCPNO&&""!==e.RCPNO&&"APPROVED"!==e.Status?t:null})).filter((function(e){return null!==e}));W.current.setSelectedRow(e)},onUnCheckAll:function(){W.current.setSelectedRow([])}}),(0,m.jsx)("div",{style:{height:"35px",display:"flex",justifyContent:"flex-end",alignItems:"center",columnGap:"5px"},children:""===O?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{ref:G,variant:"contained",color:"info",style:{height:"25px",fontSize:"12px"},onClick:function(e){Z("add"),ae(),J.current&&(J.current.disabled=!1),setTimeout((function(){ne()}),100)},children:"Add"}),(0,m.jsx)(h.Z,{ref:U,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px",background:C.Z[800]},onClick:function(e){Z("edit"),function(){(t=t||(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,H.current("\n        select '' as RCPNo\n        union \n        SELECT DISTINCT\n            (RCPNo)\n        FROM\n            PullOut_Request\n        WHERE\n            Branch = 'HO' AND Status = 'PENDING'\n        ORDER BY RCPNo\n        ");case 3:t=e.sent,n=t.data,(0,x.wait)(100).then((function(){z.current.setDataSource(n.data)}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()},children:"edit"})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{ref:J,variant:"contained",color:"success",style:{height:"25px",fontSize:"12px"},onClick:function(e){return(w=w||(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,c,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=W.current.getSelectedRowsData()).length<=0)){e.next=3;break}return e.abrupt("return",alert("No selected row found!"));case 3:a=n.map((function(e){return{Check_Date:e[0],Bank:e[1],Check_No:e[2],Check_Amnt:e[3],Status:e[4],RCPNO:e[5]}})),V.current&&Y.current&&K.current&&(o="add"===O?null===(u=L.current)||void 0===u?void 0:u.value:null===(c=M.current)||void 0===c?void 0:c.value,ee({flag:O,rcpn:o,ppno:V.current.value,name:Y.current.value,reason:K.current.value,data:JSON.stringify(a)}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)},children:"save"}),(0,m.jsx)(h.Z,{ref:Q,variant:"contained",color:"error",style:{height:"25px",fontSize:"12px"},onClick:function(e){Z(""),ae(),W.current.setData([])},children:"cancel"})]})})]})]})}}}]);
//# sourceMappingURL=8535.1efec649.chunk.js.map